<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Guides for emulators and roms | Steam Deck Pirates' Cove</title>
  <meta name="description" content="A comprehensive guide to sailing the high seas on your Steam Deck."/>
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Guides for emulators and roms | Steam Deck Pirates‚Äô Cove</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Guides for emulators and roms" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Guides for emulators and roms" />
<meta property="og:description" content="Guides for emulators and roms" />
<link rel="canonical" href="https://livinin82.github.io/steam-deck-pirates/docs/emulation-overview" />
<meta property="og:url" content="https://livinin82.github.io/steam-deck-pirates/docs/emulation-overview" />
<meta property="og:site_name" content="Steam Deck Pirates‚Äô Cove" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-10-04T13:01:15+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Guides for emulators and roms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-04T13:01:15+00:00","datePublished":"2025-10-04T13:01:15+00:00","description":"Guides for emulators and roms","headline":"Guides for emulators and roms","mainEntityOfPage":{"@type":"WebPage","@id":"https://livinin82.github.io/steam-deck-pirates/docs/emulation-overview"},"url":"https://livinin82.github.io/steam-deck-pirates/docs/emulation-overview"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/steam-deck-pirates/assets/css/site.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div class="layout">
    <aside class="sidebar" role="complementary" aria-label="Sidebar navigation">
      <div class="brand">üè¥‚Äç‚ò†Ô∏è Steam Deck Pirates' Cove</div>
      <nav class="nav" role="navigation" aria-label="Primary">
  <a href="/steam-deck-pirates/" class="nav-root" >Home</a><div class="nav-section">
          <div class="nav-section-title">Info About Steam Deck</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/info" class="" >Overview</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#game-mode">Game Mode</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#desktop-mode">Desktop Mode</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#wine">Wine</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#proton">Proton</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#prefixes">Prefixes</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#launchers">Launchers</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/info#decky-plugins">Decky Plugins</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Apps you NEED TO have installed</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/apps" class="" >Apps you NEED TO have installed</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Guides for installing games</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/installing-games" class="" >Overview</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/installing-games#installing-games-through-steam">Steam</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/installing-games#installing-games-through-lutris">Lutris</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/installing-games#installing-games-through-other-launchers">Other launchers</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/installing-games#transferring-installed-games-from-pc">Transfer from PC</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="proton">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true" aria-label="Collapse section">‚Äì</button> Guides for Proton/Wine</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/proton-wine" class="" >Overview</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/proton-wine#finding-proton-folder">Finding Proton Folder</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/proton-wine#installing-dependencies">Installing Dependencies</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/proton-wine#adding-dlls-to-proton">Adding DLLs</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Guides for emulators and roms</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/emulation-overview" class="active" aria-current="page">Overview</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#why-use-frontends">Why Use Frontends</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#installing-emudeck">EmuDeck</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#installing-retrodeck">RetroDeck</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#individual-emulators-vs-frontends">Individual emulators</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#switch-emulation">Switch Emulation</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#bios-roms-and-other-files">BIOS, ROMs, and other files</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/emulation-overview#pc-ports-vs-emulation">PC Ports</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Cracks/DLC/Updates</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/cracks-dlc-updates" class="" >Cracks/DLC/Updates</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="common">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true" aria-label="Collapse section">‚Äì</button> Common Questions</div>
          <ul>
            <li><a href="/steam-deck-pirates/docs/common-questions" class="" >Overview</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#compressed-files">Compressed Files</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#iso-files">ISO Files</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#install-locations">Install Locations</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#cant-see-external-hddsd-cardhome-folder">Can't see external HDD/SD Card</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#cant-find-save-files">Can't find save files</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#how-do-i-movebackup-my-save-files">Move/backup save files</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#controller-not-working">Controller not working</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#game-opens-steam">Game opens steam</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#no-licenses">No licenses</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#games-suddenly-wont-open-or-close">Games won't open</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#game-tries-to-load-and-immediately-stops">Game stops immediately</a></li>
            <li class="small"><a href="/steam-deck-pirates/docs/common-questions#mods-wont-load">Mods won't load</a></li>
          </ul>
        </div>
      </nav>
      <footer class="sidebar-footer">
        <a href="https://github.com/livinin82/steam-deck-pirates">GitHub</a>
      </footer>
    </aside>
    <main class="content">
      <header class="topbar" role="banner">
        <div class="page-title">Guides for emulators and roms</div>
        <button class="menu-toggle-btn" id="menuToggle" type="button" aria-label="Toggle navigation" aria-expanded="false">‚ò∞ Menu</button>
        <div class="theme-toggle">
          <button id="themeToggle" type="button" aria-label="Toggle color theme">
            <span class="icon">üåô</span>
            <span class="label">Dark</span>
          </button>
        </div>
        <script>
          (function(){
            const STORAGE_KEY = 'sdp-theme';
            const mql = window.matchMedia('(prefers-color-scheme: dark)');
            const prefersDark = mql.matches;
            const saved = localStorage.getItem(STORAGE_KEY);
            const applied = saved || (prefersDark ? 'dark' : 'light');
            if(applied === 'light') document.documentElement.setAttribute('data-theme','light');
            function setTheme(mode){
              if(mode === 'light') document.documentElement.setAttribute('data-theme','light');
              else document.documentElement.removeAttribute('data-theme');
              localStorage.setItem(STORAGE_KEY,mode);
              const btn = document.getElementById('themeToggle');
              if(btn){
                const isLight = mode==='light';
                btn.querySelector('.icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
                btn.querySelector('.label').textContent = isLight ? 'Light' : 'Dark';
              }
              if(window.renderMermaid) { window.renderMermaid(); }
            }
            window.__setTheme = setTheme;
            document.addEventListener('DOMContentLoaded',()=>{
              const btn = document.getElementById('themeToggle');
              if(!btn) return;
              btn.addEventListener('click',()=>{
                const current = document.documentElement.getAttribute('data-theme')==='light' ? 'light':'dark';
                setTheme(current==='light'?'dark':'light');
              });
              setTheme(applied);
            });
            mql.addEventListener('change', e => {
              if(!localStorage.getItem(STORAGE_KEY)){
                setTheme(e.matches ? 'dark' : 'light');
              }
            });
          })();
        </script>
      </header>
      <article id="main-content" class="doc markdown-body"><h1 id="guides-for-emulators-and-roms">Guides for emulators and roms</h1>

<p>Use the quick links below to jump to a topic:</p>

<ul>
  <li><a href="#why-use-frontends">Why Use Frontends</a></li>
  <li><a href="#installing-emudeck">Installing EmuDeck</a></li>
  <li><a href="#installing-retrodeck">Installing RetroDeck</a></li>
  <li><a href="#switch-emulation">Switch Emulation</a></li>
  <li><a href="#bios-roms-and-other-files">BIOS, ROMs, and Other Files</a></li>
  <li><a href="#individual-emulators-vs-frontends">Individual Emulators vs Frontends</a></li>
  <li><a href="#pc-ports-vs-emulation">PC Ports vs Emulation</a></li>
</ul>

<hr />
<h2 id="why-use-frontends">Why Use Frontends</h2>

<blockquote>
  <p>[!NOTE]
The Deck is an amazing emulator machine.
The sweet spot for performance is mostly in the Xbox/PS2 era, with the Switch being an exception for current gen. Anything before that should run flawlessly (on a per game basis). Do not expect to be emulating Xbox 360 (possible for some games) and definitely don‚Äôt even for a second <em>think about</em> running PS4/Xbox One or later. There is a lot of info out there regarding emulation on the deck. We are going to gather the most frequently asked questions here. Here‚Äôs a good <a href="https://www.reddit.com/r/SteamDeck/comments/1ea1675/emudeck_vs_retrodeck/">conversation</a> on the differences between the two.</p>

  <p>Regardless of which one you use, the outcome will be the same.</p>
</blockquote>

<p>Frontends like <strong>EmuDeck</strong> and <strong>RetroDeck</strong> automate folder structure, controller layouts, configuration, artwork scraping, and integration into Steam. They dramatically reduce time-to-play compared to hand‚Äërolling every emulator.</p>

<blockquote>
  <p>[!TIP]
Pick one frontend. Mixing both at the same time can lead to duplicate ROM folders, differing config expectations, and confusion when troubleshooting.</p>
</blockquote>

<hr />
<h2 id="installing-emudeck">Installing EmuDeck</h2>
<p>EmuDeck is a collection of scripts that allows you to autoconfigure your Steam Deck, it creates your roms directory structure and downloads all of the needed Emulators for you along with the best configurations for each of them. EmuDeck works great with <a href="https://github.com/SteamGridDB/steam-rom-manager">Steam Rom Manager</a> or with <a href="https://es-de.org">EmulationStation DE</a>.</p>

<div class="panel panel--soft">
<strong>Installing EmuDeck (verbatim steps)</strong>
<ol>
  <li>If you are using an SD Card, format your SD Card in Game Mode on SteamOS. SD Cards need to be formatted as ext4 (or btrfs) to be compatible with EmuDeck.
    <ul><li><strong>Skip</strong> this step if you have already formatted your SD Card</li></ul>
  </li>
  <li>Switch to Desktop Mode. Pressing the <code>STEAM</code> button, then select Power and choose <code>Switch to Desktop</code>.</li>
  <li>Download the <a href="https://www.emudeck.com/#download">EmuDeck Installer</a>.</li>
  <li>Copy the installer to your Steam Deck's desktop. Run the EmuDeck Installer.</li>
  <li>Copy your games to the <code>Emulation/roms</code> folder created by the installer. Open Steam ROM Manager through EmuDeck. Each parser corresponds to an emulator or tool. Enable which parsers you would like to use.
    <ul>
      <li>Copy your BIOS to <code>Emulation/bios</code></li>
      <li>Refer to the <a href="https://emudeck.github.io/cheat-sheet/">Cheat Sheet</a> for which folders correspond to which systems, a full list of ROM file types, and expected BIOS</li>
    </ul>
  </li>
  <li>After you have selected your parsers:
    <ul>
      <li>Click on <code>Preview</code></li>
      <li>Click <code>Parse</code></li>
      <li>Wait for all the images to download</li>
      <li>Click <code>Save apps to Steam</code>. The first time may take a few moments, After it saves successfully, your selected ROMs and tools will be added to your Steam library.</li>
    </ul>
  </li>
  <li>Close Steam ROM Manager. Click <code>Return to Game Mode</code> on your desktop and your EmuDeck install is now complete!</li>
</ol>
<em>from <a href="https://emudeck.github.io/">EmuDeck wiki</a></em>
</div>

<hr />
<h2 id="installing-retrodeck">Installing RetroDeck</h2>
<p>RetroDECK is a <a href="https://es-de.org/">ES-DE Frontend</a> powered Flatpak all-in-one game application that is still in development. Thanks to its RetroDECK Framework it builds-in a variety of software (that runs your games) like emulators and game engines in one package that is pre-configured.</p>

<div class="panel panel--soft">
<strong>Installing RetroDeck (verbatim steps)</strong>
<ul>
  <li>Put the Steam Deck into <strong>Desktop Mode</strong></li>
  <li>Install&nbsp;<strong>RetroDECK</strong> from <strong>Discover</strong></li>
  <li>Start RetroDECK first time in <strong>Desktop Mode</strong></li>
  <li>Choose where RetroDECK should create the roms folders <strong>Internal</strong> or <strong>SDCard</strong>.</li>
  <li>Put the <strong>BIOS files</strong> inside <code>~/retrodeck/bios/</code>.</li>
  <li>Put the <strong>ROMS</strong> inside <code>~/retrodeck/roms/ or &lt;sdcard&gt;/retrodeck/roms/</code> or a custom location.</li>
  <li>Choose to install&nbsp;<strong>Steam Controller Layouts</strong> for RetroDECK, it should be checked from the start.</li>
  <li>In Steam desktop go to the tab <strong>Games</strong> press <code>Add non-Steam game to My library</code> and select <strong>RetroDECK</strong> to add it into your library. If that is not working, you can <em>right-click</em> on the RetroDECK desktop icon and press <code>Add to Steam</code> in the menu.</li>
  <li>Switch over to <strong>Game Mode</strong> and go to <strong>RetroDECK</strong> on the Steam Grid under <strong>Library &gt; Non-Steam</strong></li>
  <li>Add any of the the Official Layouts under <strong>Controller Settings &gt; Controller Layouts &gt; Templates</strong> in the Steam Deck called <code>RetroDECK: Steam Deck - Neptune SIMPLE or FULL</code> with a version number. Apply the layout.</li>
  <li>Launch <strong>RetroDECK</strong> and enjoy.</li>
</ul>
<em>from <a href="https://retrodeck.readthedocs.io/en/latest/wiki_devices/steamdeck/steamdeck-start/">RetroDeck wiki</a></em>
</div>

<hr />
<h2 id="switch-emulation">Switch Emulation</h2>

<h4 id="recommended-emulators">Recommended Emulators</h4>

<blockquote>
  <p>[!NOTE]
As of 2024, the two main Switch emulators were taken down by the most ruthlessly litigious playing card game companies of all time. Taken down does not mean gone, though. Nothing is ever fully erased from the internet. <strong>EVER</strong>. With that being said, we are not going to risk having this guide taken down by linking but as of now the best and most reliable iterations are to find mirrors of <strong>Yuzu</strong> or <strong>Ryujinx</strong>. Those will have been last updated before the shutdowns. As of the time this guide was written that should not affect any of the current games that are out (at least the important ones). There is a fork of <strong>Ryujinx</strong> that is being maintained by <em>GreemDev</em>. The <strong>Yuzu</strong> forks are <strong>Sudachi</strong> or <strong>Suyu</strong>.</p>
</blockquote>

<blockquote>
  <p>[!CAUTION]
All Switch emulators require prod.keys and firmware.
We will not tell you where to find those.</p>
</blockquote>

<h4 id="switch-emulator-performance">Switch Emulator Performance</h4>
<p>Some games will run perfectly fine on the Deck. Some will have occasional frame dips. Some will have bad audio. Some just won‚Äôt work at all. This is the nature of emulation. The more popular games will have patches available for them. Someone has amazingly made a <a href="https://docs.google.com/spreadsheets/d/1AhKo6rjQHXLuZEHPozA-F-YPejLPBrj0jbPNUyNDx78/edit?gid=77197668#gid=77197668">compatibility list</a>.</p>

<hr />
<h2 id="bios-roms-and-other-files">BIOS, ROMs, and Other Files</h2>
<p>Some emulators will require BIOS files to operate. These are usually found in a multitude of places. This <a href="https://www.reddit.com/user/EmulationStranger/comments/11j09qc/idiots_guide_to_emudeck_where_to_find_bios_and/">reddit post</a> should have you on the way to finding the right BIOS and ROMs for each emulator. Specifically the ROM Megathread. Again we will not link here for safety reasons.</p>

<hr />
<h2 id="individual-emulators-vs-frontends">Individual Emulators vs Frontends</h2>
<p>Individual emulators can be installed as well. A lot of them are already on the <strong>Discover Store</strong>. While this is a perfectly viable method of setting up your emulation zone, we will not really be covering it here. The reason for this is that we want you to have the most straightforward and easy setup you can get. Also, quite frankly, if a lot of people follow the guides posted above and use the already-developed frontends we suggest, we get less questions and have an easier time supporting people. Should you choose to do things this way, you will manually have to set every emulator up, tweak them all to look right, organize the folder structure, and download so much extra stuff. By the time you‚Äôre halfway done, you‚Äôll wonder why you didn‚Äôt do RetroDeck/EmuDeck in the beginning.</p>

<hr />
<h2 id="pc-ports-vs-emulation">PC Ports vs Emulation</h2>
<p>Some of the games you want to emulate may have PC ports. Always check to see what came out for PC and if it ran better that way. For example, Scarface has way better QoL mods and patches that make it a much better experience on the deck. The real benefit of these is that you can modify the games to run better, and also there is more documentation and development for them as the files are more accessible to those modding. The biggest benefit of emulation is in most cases. you will save battery. PC ports usually have FPS mods, widescreen fixes, and a slew of other enhancements that make it a better experience overall. There are even PC ports for old N64 games like Mario 64, Perfect Dark, and so on. We highly recommend looking into these options. When you do find a PC port, be sure to go to <a href="https://www.pcgamingwiki.com/wiki/Home">PCGamingWiki</a> to see what all should be added to the games to make them perform at their best.</p>

<hr />
<h2 id="quick-comparison">Quick Comparison</h2>

<table>
  <thead>
    <tr>
      <th>Approach</th>
      <th>Setup Speed</th>
      <th>Maintenance</th>
      <th>Features / Automation</th>
      <th>Fine Control</th>
      <th>Recommended For</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>EmuDeck</td>
      <td>Fast</td>
      <td>Low</td>
      <td>High (scripts, parsers, configs)</td>
      <td>Moderate</td>
      <td>Most users / broad libraries</td>
    </tr>
    <tr>
      <td>RetroDeck</td>
      <td>Fast</td>
      <td>Low-Med</td>
      <td>High (bundled stack)</td>
      <td>Moderate</td>
      <td>Users wanting integrated Flatpak pack</td>
    </tr>
    <tr>
      <td>Individual Emulators</td>
      <td>Slow</td>
      <td>High</td>
      <td>Low</td>
      <td>High</td>
      <td>Power tweakers, niche systems</td>
    </tr>
    <tr>
      <td>PC / Source Ports</td>
      <td>Varies</td>
      <td>Varies</td>
      <td>N/A</td>
      <td>High</td>
      <td>Best experience for specific titles</td>
    </tr>
  </tbody>
</table>

<hr />
<h2 id="housekeeping-checklist">Housekeeping Checklist</h2>
<ul>
  <li>Keep SD card formatted ext4 or btrfs for case-sensitive paths &amp; performance.</li>
  <li>Back up <code class="language-plaintext highlighter-rouge">Emulation/bios</code> and <code class="language-plaintext highlighter-rouge">Emulation/roms</code> regularly.</li>
  <li>Periodically refresh artwork cache if renamed ROMs appear blank.</li>
  <li>Audit shader caches if storage tight‚Äîthey can grow large over time.</li>
  <li>Track fork vitality (especially Switch emulator forks) before updating.</li>
</ul>

</article>
      <button id="backToTop" type="button" aria-label="Back to top">Top</button>
      <script>
        // Mobile sidebar toggle + collapsible sections + scroll state
        (function(){
          const toggle = document.getElementById('menuToggle');
          const sidebar = document.querySelector('.sidebar');
          if(!toggle || !sidebar) return;
          toggle.addEventListener('click',()=>{
            const open = sidebar.classList.toggle('open');
            toggle.setAttribute('aria-expanded',open?'true':'false');
            document.body.classList.toggle('nav-open',open);
          });
          document.addEventListener('keydown',e=>{ if(e.key==='Escape' && sidebar.classList.contains('open')){ sidebar.classList.remove('open'); document.body.classList.remove('nav-open'); toggle.setAttribute('aria-expanded','false'); }});
          const sectionStatesKey = 'sdp-section-states';
            let states = {};
            try{ states = JSON.parse(localStorage.getItem(sectionStatesKey)||'{}'); }catch(_){states={}};
          document.querySelectorAll('.nav-section').forEach(sec=>{
            const id = sec.getAttribute('data-section');
            const btn = sec.querySelector('.nav-section-toggle');
            if(!btn || !id) return;
            if(states[id] === 'collapsed'){
              sec.classList.add('collapsed');
              btn.setAttribute('aria-expanded','false');
              btn.textContent = '+';
            }
            btn.addEventListener('click',()=>{
              const collapsed = sec.classList.toggle('collapsed');
              btn.setAttribute('aria-expanded', collapsed ? 'false':'true');
              btn.textContent = collapsed ? '+' : '‚Äì';
              states[id] = collapsed ? 'collapsed':'expanded';
              localStorage.setItem(sectionStatesKey, JSON.stringify(states));
            });
          });
          const scrollKey = 'sdp-sidebar-scroll';
          sidebar.scrollTop = +(localStorage.getItem(scrollKey)||0);
          sidebar.addEventListener('scroll',()=>{ localStorage.setItem(scrollKey, sidebar.scrollTop); });
        })();
        // Scroll spy (single highlight) + back to top
        (function(){
          const backBtn = document.getElementById('backToTop');
          backBtn.addEventListener('click',()=>{ window.scrollTo({top:0,behavior:'smooth'}); });
          const headings = Array.from(document.querySelectorAll('.doc h2, .doc h3'))
            .filter(h=>h.id);
          const linkMap = new Map();
          const navLinks = document.querySelectorAll('.nav a');
          navLinks.forEach(a=>{
            const href = a.getAttribute('href')||'';
            if(href.includes('#')){
              const hash = href.split('#')[1];
              if(hash) linkMap.set(hash,a);
            }
          });
          let activeId = null;
          const observer = new IntersectionObserver(entries=>{
            entries.forEach(entry=>{
              if(entry.isIntersecting){
                activeId = entry.target.id;
                update();
              }
            });
          },{ rootMargin:'-55% 0px -40% 0px', threshold:[0,1]});
          function update(){
            navLinks.forEach(a=>{ a.classList.remove('spy-active'); if(a.getAttribute('data-anchor')==='true') a.removeAttribute('aria-current'); });
            if(activeId && linkMap.has(activeId)){
              const link = linkMap.get(activeId);
              link.classList.add('spy-active');
              link.setAttribute('data-anchor','true');
              link.setAttribute('aria-current','true');
            }
          }
          headings.forEach(h=>observer.observe(h));
          window.addEventListener('scroll',()=>{
            const y = window.scrollY || document.documentElement.scrollTop;
            if(y>400) backBtn.classList.add('visible'); else backBtn.classList.remove('visible');
          });
        })();
        // Transform admonitions
        (function(){
          const map = { NOTE:'note', WARNING:'warning', CAUTION:'caution', TIP:'tip', IMPORTANT:'important' };
          document.querySelectorAll('.markdown-body blockquote').forEach(bq=>{
            const first = bq.firstElementChild || bq.firstChild;
            if(!first) return;
            const text = (first.textContent||'').trim();
            const m = text.match(/^\[(?:!)([A-Z]+)]/);
            if(m){
              const key = m[1];
              const kind = map[key];
              if(kind){
                bq.classList.add('admonition', 'admonition-'+kind);
                first.textContent = first.textContent.replace(/^\[!([A-Z]+)]\s*/,'');
                const label = document.createElement('div');
                label.className='admonition-title';
                const title = key.charAt(0)+key.slice(1).toLowerCase();
                label.textContent = title;
                bq.insertBefore(label, bq.firstChild);
              }
            }
          });
        })();
        // Mermaid loader
        (function(){
          function load(){
            if(window.mermaid){ render(); return; }
            const s=document.createElement('script');
            s.src='https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js';
            s.onload=render; document.head.appendChild(s);
          }
          function render(){
            if(!window.mermaid) return;
            const dark = document.documentElement.getAttribute('data-theme')!=='light';
            window.mermaid.initialize({ startOnLoad:false, theme: dark? 'dark':'default' });
            document.querySelectorAll('code.language-mermaid, pre code.mermaid').forEach(block=>{
              const parent = block.closest('pre') || block.parentElement;
              const code = block.textContent.trim();
              const wrapper = document.createElement('div');
              wrapper.className='mermaid';
              wrapper.textContent = code;
              parent.replaceWith(wrapper);
            });
            window.mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          }
          window.renderMermaid = render;
          if(document.readyState!=='loading') load(); else document.addEventListener('DOMContentLoaded',load);
        })();
      </script>
    </main>
  </div>
</body>
</html>
