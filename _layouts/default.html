<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}"/>
  {% seo %}
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/site.css?v={{ site.time | date: '%s' }}"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div class="layout">
    <div class="nav-backdrop" id="navBackdrop"></div>
  <aside id="auto-nav" class="auto-nav" aria-label="On this page"></aside>
    <main class="content">
    <header class="topbar" role="banner">
      <div class="page-title">
        <span class="hero-title"><span class="emoji" aria-hidden="true">üè¥‚Äç‚ò†Ô∏è</span> <span class="hero-text">{{ page.title }}</span> <span class="emoji" aria-hidden="true">üè¥‚Äç‚ò†Ô∏è</span></span>
      </div>
        <!-- Theme toggle moved to utility dock -->
        <script>
          (function(){
            const STORAGE_KEY = 'sdp-theme';
            const mql = window.matchMedia('(prefers-color-scheme: dark)');
            const saved = localStorage.getItem(STORAGE_KEY);
            const applied = saved || (mql.matches ? 'dark':'light');
            function setTheme(mode){
              if(mode==='light') document.documentElement.setAttribute('data-theme','light');
              else document.documentElement.removeAttribute('data-theme');
              localStorage.setItem(STORAGE_KEY,mode);
              const btn=document.getElementById('themeToggle');
              if(btn){ const light=mode==='light'; btn.querySelector('.icon').textContent=light?'‚òÄÔ∏è':'üåô'; }
              if(window.renderMermaid){ window.renderMermaid(); }
            }
            document.addEventListener('DOMContentLoaded',()=>{
              document.getElementById('themeToggle').addEventListener('click',()=>{
                const current=document.documentElement.getAttribute('data-theme')==='light'?'light':'dark';
                setTheme(current==='light'?'dark':'light');
              });
              setTheme(applied);
            });
            mql.addEventListener('change', e=>{ if(!localStorage.getItem(STORAGE_KEY)) setTheme(e.matches?'dark':'light'); });
          })();
        </script>
      </header>
      <article id="main-content" class="doc markdown-body">{{ content }}</article>
      <script>
        // Remove duplicate top H1 if it matches page title (defensive in case CSS hide fails or cache issues)
        (function(){
          const hero=document.querySelector('.page-title .hero-title');
          const doc=document.getElementById('main-content');
          if(!hero||!doc) return;
          const firstH1=doc.querySelector('h1');
          if(firstH1 && firstH1.textContent.trim().toLowerCase()===hero.textContent.trim().toLowerCase()){
            firstH1.parentElement.removeChild(firstH1);
          }
        })();
      </script>
      <script>
        // Cleanup: remove any stray orphan closing table tags appended by malformed markdown mixes
        (function(){
          const art=document.getElementById('main-content');
          if(!art) return;
          // Look for a closing table tag sequence at the very end with no matching opener context
          const html=art.innerHTML.trimEnd();
          if(/<\/tr><\/table>\s*$/.test(html) && !html.match(/<table[^>]*>[^<]*?<\/table>\s*$/)){
            art.innerHTML=html.replace(/<\/tr><\/table>\s*$/,'');
          }
        })();
      </script>
  <div class="utility-dock" role="group" aria-label="Page utilities">
    <button class="util-btn" id="menuToggle" aria-label="Open navigation" aria-controls="auto-nav" aria-expanded="false" type="button" title="Navigation">‚ò∞</button>
    <button class="util-btn" id="themeToggle" type="button" aria-label="Toggle color theme" title="Toggle theme"><span class="icon" aria-hidden="true">üåô</span></button>
    <div class="expander" aria-hidden="true">
      <span class="divider" aria-hidden="true"></span>
      <button class="util-btn" id="backToTop" type="button" aria-label="Back to top" title="Back to top">‚Üë</button>
    </div>
  </div>
      <script>
  // Auto-generate navigation & mobile behavior
        (function(){
          const navContainer=document.getElementById('auto-nav');
          const toggle=document.getElementById('menuToggle');
          const backdrop=document.getElementById('navBackdrop');
          const content=document.getElementById('main-content');
          if(!navContainer||!content) return;
          const headings=[...content.querySelectorAll('h2, h3')];
          if(!headings.length) return;
          let html='<nav aria-label="On this page"><ul class="nav-level">';
          let last=2;
          headings.forEach(h=>{
            const level=h.tagName==='H2'?2:3;
            if(!h.id){ h.id=h.textContent.trim().toLowerCase().replace(/[^\w]+/g,'-').replace(/(^-|-$)/g,''); }
            if(level>last) html+='<ul>';
            if(level<last) html+='</ul>';
            html+=`<li class="lvl-${level}"><a href="#${h.id}">${h.textContent}</a></li>`;
            last=level;
          });
          while(last>2){ html+='</ul>'; last--; }
          html+='</ul></nav>';
          navContainer.innerHTML=html;
          const links=[...navContainer.querySelectorAll('a')];
          const map={}; links.forEach(a=>map[a.getAttribute('href').slice(1)]=a);
          function update(){
            const y=window.scrollY+130; let current=null;
            for(const id in map){ const el=document.getElementById(id); if(el && el.offsetTop<=y) current=id; }
            links.forEach(l=>l.classList.remove('active')); if(current) map[current].classList.add('active');
          }
          window.addEventListener('scroll',update,{passive:true}); window.addEventListener('resize',update); update();
          function close(){ document.body.classList.remove('nav-open','nav-overlay'); toggle&&toggle.setAttribute('aria-expanded','false'); }
          toggle&&toggle.addEventListener('click',()=>{
            const isDesktop=window.innerWidth>=1024;
            if(isDesktop){
              const willOpen=!document.body.classList.contains('nav-overlay');
              document.body.classList.toggle('nav-overlay',willOpen);
              toggle.setAttribute('aria-expanded',willOpen);
            } else {
              const willOpen=!document.body.classList.contains('nav-open');
              document.body.classList.toggle('nav-open',willOpen);
              toggle.setAttribute('aria-expanded',willOpen);
            }
          });
          backdrop&&backdrop.addEventListener('click',close);
          navContainer.addEventListener('click',e=>{ if(e.target.tagName==='A') close(); });
          document.addEventListener('keydown',e=>{ if(e.key==='Escape') close(); });
        })();
        // Back to top visibility + click (uses .visible class & optional dock expansion)
        (function(){
          const btn=document.getElementById('backToTop');
          const dock=document.querySelector('.utility-dock');
          if(!btn||!dock) return;
          btn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
          const THRESHOLD=15; // smaller threshold so button reliably appears
          function reveal(){
            const y=window.scrollY||document.documentElement.scrollTop;
            if(y>THRESHOLD){
              dock.classList.add('expanded');
              btn.setAttribute('aria-hidden','false');
            }
          }
          window.addEventListener('scroll',reveal,{passive:true});
          // Run twice: immediate + after first frame to catch initial scroll position
          reveal(); requestAnimationFrame(reveal);
        })();
        // Admonitions
        (function(){
          const map={ NOTE:'note', WARNING:'warning', CAUTION:'caution', TIP:'tip', IMPORTANT:'important' };
          document.querySelectorAll('.markdown-body blockquote').forEach(bq=>{
            const first=bq.firstElementChild||bq.firstChild; if(!first) return;
            const text=(first.textContent||'').trim();
            const m=text.match(/^\[(?:!)([A-Z]+)]/);
            if(m){ const key=m[1]; const kind=map[key]; if(kind){ bq.classList.add('admonition','admonition-'+kind); first.textContent=first.textContent.replace(/^\[!([A-Z]+)]\s*/,''); const label=document.createElement('div'); label.className='admonition-title'; label.textContent=key.charAt(0)+key.slice(1).toLowerCase(); bq.insertBefore(label,bq.firstChild); }}
          });
        })();
        // Mermaid
        (function(){
          function load(){ if(window.mermaid){ render(); return;} const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js'; s.onload=render; document.head.appendChild(s); }
          function render(){ if(!window.mermaid) return; const dark=document.documentElement.getAttribute('data-theme')!=='light'; window.mermaid.initialize({startOnLoad:false, theme:dark?'dark':'default'}); document.querySelectorAll('code.language-mermaid, pre code.mermaid').forEach(block=>{ const parent=block.closest('pre')||block.parentElement; const code=block.textContent.trim(); const wrapper=document.createElement('div'); wrapper.className='mermaid'; wrapper.textContent=code; parent.replaceWith(wrapper); }); window.mermaid.init(undefined, document.querySelectorAll('.mermaid')); }
          window.renderMermaid=render; if(document.readyState!=='loading') load(); else document.addEventListener('DOMContentLoaded',load);
        })();
      </script>
    </main>
  </div>
</body>
</html>
