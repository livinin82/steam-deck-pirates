<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}"/>
  {% seo %}
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/site.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div class="layout">
    <aside class="sidebar" role="complementary" aria-label="Sidebar navigation">
      <div class="brand">üè¥‚Äç‚ò†Ô∏è {{ site.title }}</div>
      <nav class="nav" role="navigation" aria-label="Primary">
        <a href="{{ site.baseurl }}/" class="nav-root" aria-current="page">Home</a>
        <!-- Anchor-only navigation -->
        <div class="nav-section" data-section="info">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Info About Steam Deck</div>
          <ul>
            <li class="small"><a href="#info-about-steam-deck">Overview</a></li>
            <li class="small"><a href="#game-mode">Game Mode</a></li>
            <li class="small"><a href="#desktop-mode">Desktop Mode</a></li>
            <li class="small"><a href="#wine">Wine</a></li>
            <li class="small"><a href="#proton">Proton</a></li>
            <li class="small"><a href="#prefixes">Prefixes</a></li>
            <li class="small"><a href="#launchers">Launchers</a></li>
            <li class="small"><a href="#decky-plugins">Decky Plugins</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="apps">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Apps</div>
          <ul>
            <li class="small"><a href="#apps-you-need-to-have-installed">All Apps</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="installing">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Installing Games</div>
          <ul>
            <li class="small"><a href="#guides-for-installing-games">Overview</a></li>
            <li class="small"><a href="#installing-games-through-steam">Steam</a></li>
            <li class="small"><a href="#installing-games-through-lutris">Lutris</a></li>
            <li class="small"><a href="#installing-games-through-other-launchers">Other launchers</a></li>
            <li class="small"><a href="#transferring-installed-games-from-pc">Transfer from PC</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="proton">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Proton/Wine</div>
          <ul>
            <li class="small"><a href="#guides-for-protonwine">Overview</a></li>
            <li class="small"><a href="#finding-non-steam-game-proton-folder">Finding Proton Folder</a></li>
            <li class="small"><a href="#installing-dependencies">Installing Dependencies</a></li>
            <li class="small"><a href="#adding-dlls-to-proton">Adding DLLs</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="emulators">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Emulation</div>
          <ul>
            <li class="small"><a href="#guides-for-emulators-and-roms">Overview</a></li>
            <li class="small"><a href="#emudeck">EmuDeck</a></li>
            <li class="small"><a href="#retrodeck">RetroDeck</a></li>
            <li class="small"><a href="#individual-emulators">Individual emulators</a></li>
            <li class="small"><a href="#switch-emulation">Switch Emulation</a></li>
            <li class="small"><a href="#bios-roms-and-other-files">BIOS/ROMs</a></li>
            <li class="small"><a href="#pc-ports">PC Ports</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="cracks">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Cracks/DLC</div>
          <ul>
            <li class="small"><a href="#cracksdlcupdates">Cracks/DLC/Updates</a></li>
          </ul>
        </div>
        <div class="nav-section" data-section="common">
          <div class="nav-section-title"><button class="nav-section-toggle" type="button" aria-expanded="true">‚Äì</button> Common Q's</div>
          <ul>
            <li class="small"><a href="#common-questionsthings-you-will-encounter">Overview</a></li>
            <li class="small"><a href="#compressed-files-rar-zip-7z-etc">Compressed Files</a></li>
            <li class="small"><a href="#iso-files">ISO Files</a></li>
            <li class="small"><a href="#install-locations">Install Locations</a></li>
            <li class="small"><a href="#cant-see-external-hddsd-cardhome-folder">External Drives</a></li>
            <li class="small"><a href="#cant-find-save-files">Save Files</a></li>
            <li class="small"><a href="#how-do-i-movebackup-my-save-files">Backup Saves</a></li>
            <li class="small"><a href="#controller-not-working">Controller Issues</a></li>
            <li class="small"><a href="#game-opens-steam">Game opens Steam</a></li>
            <li class="small"><a href="#no-licenses">No licenses</a></li>
            <li class="small"><a href="#games-suddenly-wont-open-or-close">Won't open/close</a></li>
            <li class="small"><a href="#game-tries-to-load-and-immediately-stops">Stops Immediately</a></li>
            <li class="small"><a href="#mods-wont-load">Mods won't load</a></li>
          </ul>
        </div>
      </nav>
      <footer class="sidebar-footer">
        <a href="https://github.com/{{ site.github.owner_name }}/{{ site.github.repository_name }}">GitHub</a>
      </footer>
    </aside>
    <main class="content">
      <header class="topbar" role="banner">
        <div class="page-title">{{ page.title }}</div>
        <button class="menu-toggle-btn" id="menuToggle" type="button" aria-label="Toggle navigation" aria-expanded="false">‚ò∞ Menu</button>
        <div class="theme-toggle">
          <button id="themeToggle" type="button" aria-label="Toggle color theme">
            <span class="icon">üåô</span>
            <span class="label">Dark</span>
          </button>
        </div>
        <script>
          (function(){
            const STORAGE_KEY = 'sdp-theme';
            const mql = window.matchMedia('(prefers-color-scheme: dark)');
            const saved = localStorage.getItem(STORAGE_KEY);
            const applied = saved || (mql.matches ? 'dark':'light');
            function setTheme(mode){
              if(mode==='light') document.documentElement.setAttribute('data-theme','light');
              else document.documentElement.removeAttribute('data-theme');
              localStorage.setItem(STORAGE_KEY,mode);
              const btn=document.getElementById('themeToggle');
              if(btn){ const light=mode==='light'; btn.querySelector('.icon').textContent=light?'‚òÄÔ∏è':'üåô'; btn.querySelector('.label').textContent=light?'Light':'Dark'; }
              if(window.renderMermaid){ window.renderMermaid(); }
            }
            document.addEventListener('DOMContentLoaded',()=>{
              document.getElementById('themeToggle').addEventListener('click',()=>{
                const current=document.documentElement.getAttribute('data-theme')==='light'?'light':'dark';
                setTheme(current==='light'?'dark':'light');
              });
              setTheme(applied);
            });
            mql.addEventListener('change', e=>{ if(!localStorage.getItem(STORAGE_KEY)) setTheme(e.matches?'dark':'light'); });
          })();
        </script>
      </header>
      <article id="main-content" class="doc markdown-body">{{ content }}</article>
      <script>
        // Cleanup: remove any stray orphan closing table tags appended by malformed markdown mixes
        (function(){
          const art=document.getElementById('main-content');
          if(!art) return;
          // Look for a closing table tag sequence at the very end with no matching opener context
          const html=art.innerHTML.trimEnd();
          if(/<\/tr><\/table>\s*$/.test(html) && !html.match(/<table[^>]*>[^<]*?<\/table>\s*$/)){
            art.innerHTML=html.replace(/<\/tr><\/table>\s*$/,'');
          }
        })();
      </script>
      <button id="backToTop" type="button" aria-label="Back to top">Top</button>
      <script>
        // Sidebar toggle & collapsibles
        (function(){
          const toggle=document.getElementById('menuToggle');
          const sidebar=document.querySelector('.sidebar');
          toggle.addEventListener('click',()=>{
            const open=sidebar.classList.toggle('open');
            toggle.setAttribute('aria-expanded',open?'true':'false');
            document.body.classList.toggle('nav-open',open);
          });
          document.addEventListener('keydown',e=>{ if(e.key==='Escape'&&sidebar.classList.contains('open')){ sidebar.classList.remove('open'); document.body.classList.remove('nav-open'); toggle.setAttribute('aria-expanded','false'); }});
          const sectionStatesKey='sdp-section-states';
          let states={};
          try{ states=JSON.parse(localStorage.getItem(sectionStatesKey)||'{}'); }catch(_){states={}};
          document.querySelectorAll('.nav-section').forEach(sec=>{
            const id=sec.getAttribute('data-section');
            const btn=sec.querySelector('.nav-section-toggle');
            if(!btn||!id) return;
            if(states[id]==='collapsed'){
              sec.classList.add('collapsed');
              btn.setAttribute('aria-expanded','false');
              btn.textContent='+';
            }
            btn.addEventListener('click',()=>{
              const collapsed=sec.classList.toggle('collapsed');
              btn.setAttribute('aria-expanded',collapsed?'false':'true');
              btn.textContent=collapsed?'+':'‚Äì';
              states[id]=collapsed?'collapsed':'expanded';
              localStorage.setItem(sectionStatesKey, JSON.stringify(states));
            });
          });
          const scrollKey='sdp-sidebar-scroll';
          sidebar.scrollTop=+(localStorage.getItem(scrollKey)||0);
          sidebar.addEventListener('scroll',()=>localStorage.setItem(scrollKey, sidebar.scrollTop));
        })();
        // Scroll spy (deterministic scroll position approach for stability at top & bottom)
        (function(){
          const backBtn=document.getElementById('backToTop');
          if(backBtn){ backBtn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'})); }
          const headings=Array.from(document.querySelectorAll('.doc h2, .doc h3, .doc h4')).filter(h=>h.id);
          if(!headings.length) return;
          const navLinks=[...document.querySelectorAll('.nav a[href^="#"]')];
          const map=new Map();
          navLinks.forEach(a=>{ const id=a.getAttribute('href').slice(1); if(id) map.set(id,a); });
          const TOP_OFFSET=120; // compensate for top bar / comfortable activation point
          let lastActive=null;

          function resolveMapped(id){
            if(map.has(id)) return id;
            const idx=headings.findIndex(h=>h.id===id);
            for(let i=idx-1;i>=0;i--){ if(map.has(headings[i].id)) return headings[i].id; }
            return null;
          }

            function computeActive(){
            const scrollY=window.scrollY||document.documentElement.scrollTop;
            const viewportBottom=scrollY + window.innerHeight;
            const docHeight=Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
            // Near top
            if(scrollY < 50) return headings[0].id;
            // Near bottom: force last heading
            if(viewportBottom >= docHeight - 10) return headings[headings.length-1].id;
            // Find last heading whose top is above the activation line
            const activationLine=scrollY + TOP_OFFSET;
            let current=headings[0].id;
            for(const h of headings){
              const top=h.getBoundingClientRect().top + scrollY; // doc position
              if(top <= activationLine) current=h.id; else break;
            }
            return current;
          }

          function render(){
            const rawId=computeActive();
            let id=resolveMapped(rawId)||rawId;
            if(id===lastActive) return;
            lastActive=id;
            navLinks.forEach(a=>{ a.classList.remove('spy-active'); a.removeAttribute('aria-current'); });
            if(map.has(id)){
              const link=map.get(id);
              link.classList.add('spy-active');
              link.setAttribute('aria-current','true');
            }
          }

          let ticking=false;
          function onScroll(){
            if(!ticking){
              requestAnimationFrame(()=>{ render(); if(backBtn){ const y=window.scrollY||document.documentElement.scrollTop; if(y>400) backBtn.classList.add('visible'); else backBtn.classList.remove('visible'); } ticking=false; });
              ticking=true;
            }
          }
          window.addEventListener('scroll', onScroll, {passive:true});
          window.addEventListener('resize', ()=>{ lastActive=null; render(); });
          // Initial pass
          render();
        })();
        // Admonitions
        (function(){
          const map={ NOTE:'note', WARNING:'warning', CAUTION:'caution', TIP:'tip', IMPORTANT:'important' };
          document.querySelectorAll('.markdown-body blockquote').forEach(bq=>{
            const first=bq.firstElementChild||bq.firstChild; if(!first) return;
            const text=(first.textContent||'').trim();
            const m=text.match(/^\[(?:!)([A-Z]+)]/);
            if(m){ const key=m[1]; const kind=map[key]; if(kind){ bq.classList.add('admonition','admonition-'+kind); first.textContent=first.textContent.replace(/^\[!([A-Z]+)]\s*/,''); const label=document.createElement('div'); label.className='admonition-title'; label.textContent=key.charAt(0)+key.slice(1).toLowerCase(); bq.insertBefore(label,bq.firstChild); }}
          });
        })();
        // Mermaid
        (function(){
          function load(){ if(window.mermaid){ render(); return;} const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js'; s.onload=render; document.head.appendChild(s); }
          function render(){ if(!window.mermaid) return; const dark=document.documentElement.getAttribute('data-theme')!=='light'; window.mermaid.initialize({startOnLoad:false, theme:dark?'dark':'default'}); document.querySelectorAll('code.language-mermaid, pre code.mermaid').forEach(block=>{ const parent=block.closest('pre')||block.parentElement; const code=block.textContent.trim(); const wrapper=document.createElement('div'); wrapper.className='mermaid'; wrapper.textContent=code; parent.replaceWith(wrapper); }); window.mermaid.init(undefined, document.querySelectorAll('.mermaid')); }
          window.renderMermaid=render; if(document.readyState!=='loading') load(); else document.addEventListener('DOMContentLoaded',load);
        })();
      </script>
    </main>
  </div>
</body>
</html>
