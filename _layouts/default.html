<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}"/>
  {% seo %}
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/site.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div class="layout">
    <aside class="sidebar" role="complementary" aria-label="Sidebar navigation">
      <div class="brand">üè¥‚Äç‚ò†Ô∏è {{ site.title }}</div>
      <nav class="nav" role="navigation" aria-label="Primary">
        <a href="{{ site.baseurl }}/" class="nav-root" aria-current="{{ page.url == '/' | ternary: 'page', 'false' }}">Home</a>
        {% assign grouped = site.docs | group_by: 'parent' %}
        {% for parent in site.nav_parents_order %}
          {% assign bucket = grouped | where: 'name', parent | first %}
          {% if bucket %}
            <div class="nav-section">
              <div class="nav-section-title">{{ parent }}</div>
              <ul>
                {% for doc in bucket.items | sort: 'nav_order' %}
                  <li>
                    <a href="{{ doc.url | relative_url }}" class="{% if page.url == doc.url %}active{% endif %}" {% if page.url == doc.url %}aria-current="page"{% endif %}>{{ doc.title }}</a>
                    {% if doc.url == '/docs/emulation-overview' %}
                      <ul class="sub sub--emulation">
                        <li><a href="{{ '/docs/emulation-overview#why-use-frontends' | relative_url }}">Why Use Frontends</a></li>
                        <li><a href="{{ '/docs/emulation-overview#installing-emudeck' | relative_url }}">Installing EmuDeck</a></li>
                        <li><a href="{{ '/docs/emulation-overview#installing-retrodeck' | relative_url }}">Installing RetroDeck</a></li>
                        <li><a href="{{ '/docs/emulation-overview#switch-emulation' | relative_url }}">Switch Emulation</a></li>
                        <li><a href="{{ '/docs/emulation-overview#bios-roms-and-other-files' | relative_url }}">BIOS / ROMs</a></li>
                        <li><a href="{{ '/docs/emulation-overview#individual-emulators-vs-frontends' | relative_url }}">Individual vs Frontends</a></li>
                        <li><a href="{{ '/docs/emulation-overview#pc-ports-vs-emulation' | relative_url }}">PC Ports</a></li>
                        <li><a href="{{ '/docs/emulation-overview#quick-comparison' | relative_url }}">Comparison</a></li>
                        <li><a href="{{ '/docs/emulation-overview#housekeeping-checklist' | relative_url }}">Housekeeping</a></li>
                      </ul>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        {% endfor %}
        <div class="nav-section">
          <div class="nav-section-title">All Guides (A‚ÄìZ)</div>
          <ul>
            {% assign allSorted = site.docs | sort: 'title' %}
            {% for doc in allSorted %}
              <li class="small"><a href="{{ doc.url | relative_url }}">{{ doc.title }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </nav>
      <footer class="sidebar-footer">
        <a href="https://github.com/{{ site.github.owner_name }}/{{ site.github.repository_name }}">GitHub</a>
      </footer>
    </aside>
    <main class="content">
      <header class="topbar" role="banner">
        <div class="page-title">{{ page.title }}</div>
        <div class="theme-toggle">
          <button id="themeToggle" type="button" aria-label="Toggle color theme">
            <span class="icon">üåô</span>
            <span class="label">Dark</span>
          </button>
        </div>
        <script>
          (function(){
            const STORAGE_KEY = 'sdp-theme';
            const mql = window.matchMedia('(prefers-color-scheme: dark)');
            const prefersDark = mql.matches;
            const saved = localStorage.getItem(STORAGE_KEY);
            const applied = saved || (prefersDark ? 'dark' : 'light');
            if(applied === 'light') document.documentElement.setAttribute('data-theme','light');
            function setTheme(mode){
              if(mode === 'light') document.documentElement.setAttribute('data-theme','light');
              else document.documentElement.removeAttribute('data-theme');
              localStorage.setItem(STORAGE_KEY,mode);
              const btn = document.getElementById('themeToggle');
              if(btn){
                const isLight = mode==='light';
                btn.querySelector('.icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
                btn.querySelector('.label').textContent = isLight ? 'Light' : 'Dark';
              }
            }
            window.__setTheme = setTheme;
            document.addEventListener('DOMContentLoaded',()=>{
              const btn = document.getElementById('themeToggle');
              if(!btn) return;
              btn.addEventListener('click',()=>{
                const current = document.documentElement.getAttribute('data-theme')==='light' ? 'light':'dark';
                setTheme(current==='light'?'dark':'light');
              });
              setTheme(applied);
            });
            // Live respond to system changes if user hasn't explicitly chosen
            mql.addEventListener('change', e => {
              if(!localStorage.getItem(STORAGE_KEY)){
                setTheme(e.matches ? 'dark' : 'light');
              }
            });
          })();
        </script>
      </header>
      <article id="main-content" class="doc markdown-body">{{ content }}</article>
      <script>
        // Transform GitHub style admonitions inside blockquotes beginning with [!TAG]
        (function(){
          const map = { NOTE:'note', WARNING:'warning', CAUTION:'caution', TIP:'tip', IMPORTANT:'important' };
          document.querySelectorAll('.markdown-body blockquote').forEach(bq=>{
            const first = bq.firstElementChild || bq.firstChild;
            if(!first) return;
            const text = (first.textContent||'').trim();
            const m = text.match(/^\[(?:!)([A-Z]+)]/);
            if(m){
              const key = m[1];
              const kind = map[key];
              if(kind){
                bq.classList.add('admonition', 'admonition-'+kind);
                // Remove the marker from first node
                first.textContent = first.textContent.replace(/^\[!([A-Z]+)]\s*/,'');
                const label = document.createElement('div');
                label.className='admonition-title';
                const title = key.charAt(0)+key.slice(1).toLowerCase();
                label.textContent = title;
                bq.insertBefore(label, bq.firstChild);
              }
            }
          });
        })();
      </script>
    </main>
  </div>
</body>
</html>
