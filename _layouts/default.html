<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}"/>
  {% seo %}
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/site.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div class="layout">
    <aside class="sidebar" role="complementary" aria-label="Sidebar navigation">
      <div class="brand">üè¥‚Äç‚ò†Ô∏è {{ site.title }}</div>
      <nav class="nav" role="navigation" aria-label="Primary">
        <a href="{{ site.baseurl }}/" class="nav-root" aria-current="{{ page.url == '/' | ternary: 'page', 'false' }}">Home</a>
        {%- comment -%}
          Navigation that exactly mirrors the README structure
        {%- endcomment -%}
        <div class="nav-section">
          <div class="nav-section-title">Info About Steam Deck</div>
          <ul>
            {% assign info_doc = site.docs | where: 'id', 'info' | first %}
            {% if info_doc %}
              <li><a href="{{ info_doc.url | relative_url }}" class="{% if page.url == info_doc.url %}active{% endif %}" {% if page.url == info_doc.url %}aria-current="page"{% endif %}>Overview</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#game-mode">Game Mode</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#desktop-mode">Desktop Mode</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#wine">Wine</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#proton">Proton</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#prefixes">Prefixes</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#launchers">Launchers</a></li>
              <li class="small"><a href="{{ info_doc.url | relative_url }}#decky-plugins">Decky Plugins</a></li>
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Apps you NEED TO have installed</div>
          <ul>
            {% assign apps_doc = site.docs | where: 'id', 'apps' | first %}
            {% if apps_doc %}
              <li><a href="{{ apps_doc.url | relative_url }}" class="{% if page.url == apps_doc.url %}active{% endif %}" {% if page.url == apps_doc.url %}aria-current="page"{% endif %}>{{ apps_doc.title }}</a></li>
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Guides for installing games</div>
          <ul>
            {% assign install_doc = site.docs | where: 'id', 'install-guides' | first %}
            {% if install_doc %}
              <li><a href="{{ install_doc.url | relative_url }}" class="{% if page.url == install_doc.url %}active{% endif %}" {% if page.url == install_doc.url %}aria-current="page"{% endif %}>Overview</a></li>
              {% assign install_children = site.docs | where: 'parent_id', 'install-guides' | sort: 'nav_order' %}
              {% for doc in install_children %}
                <li><a href="{{ doc.url | relative_url }}" class="{% if page.url == doc.url %}active{% endif %}" {% if page.url == doc.url %}aria-current="page"{% endif %}>{{ doc.title }}</a></li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Guides for Proton/Wine</div>
          <ul>
            {% assign proton_doc = site.docs | where: 'id', 'proton-wine' | first %}
            {% if proton_doc %}
              <li><a href="{{ proton_doc.url | relative_url }}" class="{% if page.url == proton_doc.url %}active{% endif %}" {% if page.url == proton_doc.url %}aria-current="page"{% endif %}>Overview</a></li>
              {% assign proton_children = site.docs | where: 'parent_id', 'proton-wine' | sort: 'nav_order' %}
              {% for doc in proton_children %}
                <li><a href="{{ doc.url | relative_url }}" class="{% if page.url == doc.url %}active{% endif %}" {% if page.url == doc.url %}aria-current="page"{% endif %}>{{ doc.title }}</a></li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Guides for emulators and roms</div>
          <ul>
            {% assign emulation_doc = site.docs | where: 'id', 'emulation' | first %}
            {% if emulation_doc %}
              <li><a href="{{ emulation_doc.url | relative_url }}" class="{% if page.url == emulation_doc.url %}active{% endif %}" {% if page.url == emulation_doc.url %}aria-current="page"{% endif %}>Overview</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#why-use-frontends">Why Use Frontends</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#installing-emudeck">EmuDeck</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#installing-retrodeck">RetroDeck</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#individual-emulators-vs-frontends">Individual emulators</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#switch-emulation">Switch Emulation</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#bios-roms-and-other-files">BIOS, ROMs, and other files</a></li>
              <li class="small"><a href="{{ emulation_doc.url | relative_url }}#pc-ports-vs-emulation">PC Ports</a></li>
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Cracks/DLC/Updates</div>
          <ul>
            {% assign cracks_doc = site.docs | where: 'id', 'cracks' | first %}
            {% if cracks_doc %}
              <li><a href="{{ cracks_doc.url | relative_url }}" class="{% if page.url == cracks_doc.url %}active{% endif %}" {% if page.url == cracks_doc.url %}aria-current="page"{% endif %}>{{ cracks_doc.title }}</a></li>
            {% endif %}
          </ul>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Common Questions</div>
          <ul>
            {% assign common_doc = site.docs | where: 'id', 'common-questions' | first %}
            {% if common_doc %}
              <li><a href="{{ common_doc.url | relative_url }}" class="{% if page.url == common_doc.url %}active{% endif %}" {% if page.url == common_doc.url %}aria-current="page"{% endif %}>Overview</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#compressed-files">Compressed Files</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#iso-files">ISO Files</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#install-locations">Install Locations</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#cant-see-external-hddsd-cardhome-folder">Can't see external HDD/SD Card</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#cant-find-save-files">Can't find save files</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#how-do-i-movebackup-my-save-files">Move/backup save files</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#controller-not-working">Controller not working</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#game-opens-steam">Game opens steam</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#no-licenses">No licenses</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#games-suddenly-wont-open-or-close">Games won't open</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#game-tries-to-load-and-immediately-stops">Game stops immediately</a></li>
              <li class="small"><a href="{{ common_doc.url | relative_url }}#mods-wont-load">Mods won't load</a></li>
            {% endif %}
          </ul>
        </div>
      </nav>
      <footer class="sidebar-footer">
        <a href="https://github.com/{{ site.github.owner_name }}/{{ site.github.repository_name }}">GitHub</a>
      </footer>
    </aside>
    <main class="content">
      <header class="topbar" role="banner">
        <div class="page-title">{{ page.title }}</div>
        <button class="menu-toggle-btn" id="menuToggle" type="button" aria-label="Toggle navigation" aria-expanded="false">‚ò∞ Menu</button>
        <div class="theme-toggle">
          <button id="themeToggle" type="button" aria-label="Toggle color theme">
            <span class="icon">üåô</span>
            <span class="label">Dark</span>
          </button>
        </div>
        <script>
          (function(){
            const STORAGE_KEY = 'sdp-theme';
            const mql = window.matchMedia('(prefers-color-scheme: dark)');
            const prefersDark = mql.matches;
            const saved = localStorage.getItem(STORAGE_KEY);
            const applied = saved || (prefersDark ? 'dark' : 'light');
            if(applied === 'light') document.documentElement.setAttribute('data-theme','light');
            function setTheme(mode){
              if(mode === 'light') document.documentElement.setAttribute('data-theme','light');
              else document.documentElement.removeAttribute('data-theme');
              localStorage.setItem(STORAGE_KEY,mode);
              const btn = document.getElementById('themeToggle');
              if(btn){
                const isLight = mode==='light';
                btn.querySelector('.icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
                btn.querySelector('.label').textContent = isLight ? 'Light' : 'Dark';
              }
            }
            window.__setTheme = setTheme;
            document.addEventListener('DOMContentLoaded',()=>{
              const btn = document.getElementById('themeToggle');
              if(!btn) return;
              btn.addEventListener('click',()=>{
                const current = document.documentElement.getAttribute('data-theme')==='light' ? 'light':'dark';
                setTheme(current==='light'?'dark':'light');
              });
              setTheme(applied);
            });
            // Live respond to system changes if user hasn't explicitly chosen
            mql.addEventListener('change', e => {
              if(!localStorage.getItem(STORAGE_KEY)){
                setTheme(e.matches ? 'dark' : 'light');
              }
            });
          })();
        </script>
      </header>
      <article id="main-content" class="doc markdown-body">{{ content }}</article>
      <button id="backToTop" type="button" aria-label="Back to top">Top</button>
      <script>
        // Mobile sidebar toggle
        (function(){
          const toggle = document.getElementById('menuToggle');
          const sidebar = document.querySelector('.sidebar');
          if(!toggle || !sidebar) return;
          toggle.addEventListener('click',()=>{
            const open = sidebar.classList.toggle('open');
            toggle.setAttribute('aria-expanded',open?'true':'false');
            document.body.classList.toggle('nav-open',open);
          });
          document.addEventListener('keydown',e=>{ if(e.key==='Escape' && sidebar.classList.contains('open')){ sidebar.classList.remove('open'); document.body.classList.remove('nav-open'); toggle.setAttribute('aria-expanded','false'); }});
        })();
        // Scroll spy + back to top
        (function(){
          const backBtn = document.getElementById('backToTop');
          backBtn.addEventListener('click',()=>{ window.scrollTo({top:0,behavior:'smooth'}); });
          const headings = Array.from(document.querySelectorAll('.doc h2, .doc h3, .doc h4'))
            .filter(h=>h.id);
          const linkMap = new Map();
          const navLinks = document.querySelectorAll('.nav a[href*="#"]');
            navLinks.forEach(a=>{ try { const hash = decodeURIComponent(a.getAttribute('href').split('#')[1]||''); if(hash){ linkMap.set(hash,a);} } catch(_){} });
          let activeId = null;
          const observer = new IntersectionObserver(entries=>{
            entries.forEach(entry=>{
              if(entry.isIntersecting){ activeId = entry.target.id; update(); }
            });
          },{ rootMargin:'-55% 0px -40% 0px', threshold:[0,1]});
          function update(){
            navLinks.forEach(a=>a.classList.remove('spy-active'));
            if(activeId && linkMap.has(activeId)) linkMap.get(activeId).classList.add('spy-active');
          }
          headings.forEach(h=>observer.observe(h));
          window.addEventListener('scroll',()=>{
            const y = window.scrollY || document.documentElement.scrollTop;
            if(y>400) backBtn.classList.add('visible'); else backBtn.classList.remove('visible');
          });
        })();
        // Transform GitHub style admonitions inside blockquotes beginning with [!TAG]
        (function(){
          const map = { NOTE:'note', WARNING:'warning', CAUTION:'caution', TIP:'tip', IMPORTANT:'important' };
          document.querySelectorAll('.markdown-body blockquote').forEach(bq=>{
            const first = bq.firstElementChild || bq.firstChild;
            if(!first) return;
            const text = (first.textContent||'').trim();
            const m = text.match(/^\[(?:!)([A-Z]+)]/);
            if(m){
              const key = m[1];
              const kind = map[key];
              if(kind){
                bq.classList.add('admonition', 'admonition-'+kind);
                // Remove the marker from first node
                first.textContent = first.textContent.replace(/^\[!([A-Z]+)]\s*/,'');
                const label = document.createElement('div');
                label.className='admonition-title';
                const title = key.charAt(0)+key.slice(1).toLowerCase();
                label.textContent = title;
                bq.insertBefore(label, bq.firstChild);
              }
            }
          });
        })();
      </script>
    </main>
  </div>
</body>
</html>
